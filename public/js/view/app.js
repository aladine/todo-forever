define(["jquery","underscore","backbone","collection/todos","view/todo","text!tmpl/stat.handlebars","handlebars","common"],function(e,t,i,s,n,r,l,h){"use strict";var o=i.View.extend({el:"#todoapp",template:l.compile(r),events:{"keypress #new-todo":"createOnEnter","keypress #new-search":"search","click #clear-completed":"clearDone","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#new-todo"),this.$search=this.$("#new-search"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.$todoList=this.$("#todo-list"),this.listenTo(s,"add",this.addOne),this.listenTo(s,"reset",this.addAll),this.listenTo(s,"change:done",this.filterOne),this.listenTo(s,"filter",this.filterAll),this.listenTo(s,"all",this.render),this.registerHandlebarsPlugins(),s.fetch({reset:!0})},render:function(){var e=this.filtered||s,t=e.done().length,i=e.remaining().length;e.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.template({done:t,remaining:i})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(h.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!i},registerHandlebarsPlugins:function(){l.registerHelper("ifCond",function(e,t,i){return e===t?i.fn(this):i.inverse(this)})},addOne:function(e){var t=new n({model:e});this.$todoList.append(t.render().el)},addAll:function(){var e=this.filtered||s;this.$todoList.empty(),e.each(this.addOne,this)},filterOne:function(e){e.trigger("visible")},filterAll:function(){var e=this.filtered||s;e.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),desc:"",order:s.nextOrder(),done:!1,created:new Date,updated:new Date}},createOnEnter:function(e){e.which===h.ENTER_KEY&&this.$input.val().trim()&&(s.create(this.newAttributes()),s.sort(),this.$search.val(""),this.$input.val(""),this.search())},search:function(){var e=this.$search.val().trim();this.filtered=!e||e.length<2?null:s.search(e),this.addAll(),this.render()},clearDone:function(){return t.invoke(s.done(),"destroy"),!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;s.each(function(t){t.save({done:e})})}});return o});