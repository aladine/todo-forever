define(["jquery","underscore","backbone","collection/todos","view/todo","text!tmpl/stat.handlebars","handlebars","common"],function(e,t,i,n,s,l,o,r){"use strict";var h=i.View.extend({el:"#todoapp",template:o.compile(l),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearDone","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#new-todo"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.$todoList=this.$("#todo-list"),this.listenTo(n,"add",this.addOne),this.listenTo(n,"reset",this.addAll),this.listenTo(n,"change:done",this.filterOne),this.listenTo(n,"filter",this.filterAll),this.listenTo(n,"all",this.render),this.registerHandlebarsPlugins(),n.fetch({reset:!0})},render:function(){var e=n.done().length,t=n.remaining().length;n.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.template({done:e,remaining:t})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(r.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!t},registerHandlebarsPlugins:function(){o.registerHelper("ifCond",function(e,t,i){return e===t?i.fn(this):i.inverse(this)})},addOne:function(e){var t=new s({model:e});this.$todoList.append(t.render().el)},addAll:function(){this.$todoList.empty(),n.each(this.addOne,this)},filterOne:function(e){e.trigger("visible")},filterAll:function(){n.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:n.nextOrder(),done:!1}},createOnEnter:function(e){e.which===r.ENTER_KEY&&this.$input.val().trim()&&(n.create(this.newAttributes()),this.$input.val(""))},clearDone:function(){return t.invoke(n.done(),"destroy"),!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;n.each(function(t){t.save({done:e})})}});return h});