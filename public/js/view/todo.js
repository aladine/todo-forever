define(["jquery","underscore","backbone","text!tmpl/item.handlebars","handlebars","common"],function(e,t,i,s,n,l){"use strict";var o=i.View.extend({tagName:"li",template:n.compile(s),events:{"click .toggle":"toggleDone","dblclick label":"edit","click .destroy":"clear","keypress .edit":"updateOnEnter","keydown .edit":"revertOnEscape","click .js_save":"save","click .js_cancel":"close"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"visible",this.toggleVisible),this.registerHandlebarsPlugins()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("done",this.model.get("done")),this.toggleVisible(),this.$input=this.$(".edit"),this.$textarea=this.$(".edit_desc"),this},registerHandlebarsPlugins:function(){n.registerHelper("ifCond",function(e,t,i){return e===t?i.fn(this):i.inverse(this)}),n.registerHelper("dateFormat",function(e){return(""+new Date(e)).substring(4,24)})},toggleVisible:function(){this.$el.toggleClass("hidden",this.isHidden())},isHidden:function(){var e=this.model.get("done");return!e&&"done"===l.TodoFilter||e&&"active"===l.TodoFilter},toggleDone:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$textarea.val(this.$textarea.data("desc")),this.$input.focus()},save:function(){var e=this.$input.val(),t=e.trim(),i=this.sanitize(this.$textarea.val());t?(this.model.save({title:t,desc:i}),e!==t&&this.model.trigger("change")):this.clear(),this.close()},close:function(){this.$el.removeClass("editing")},updateOnEnter:function(e){e.keyCode===l.ENTER_KEY&&this.save()},revertOnEscape:function(e){e.which===l.ESCAPE_KEY&&(this.$el.removeClass("editing"),this.$input.val(this.model.get("title")))},clear:function(){this.model.get("done")?this.model.destroy():l.alert("This task should be marked completed before deleting.")},sanitize:function(e){return e.replace(/\s+/g," ").split(" ").map(function(e){return e.substring(0,30)}).join(" ")}});return o});